# DB関連メモ
```
docker run -d --hostname local-oracle-db --name local-oracle-db -p 49161:1521 -p 58080:8080 -e ORACLE_ALLOW_REMOTE=true -e ORACLE_DISABLE_ASYNCH_IO=true wnameless/oracle-xe-11g-r2

docker exec -d local-oracle-db mkdir -p /opt/cheering-local-restaurant/db
docker exec -d local-oracle-db chown -R oracle:dba /opt/cheering-local-restaurant/db

CREATE TABLESPACE RESTAURANT
	DATAFILE '/opt/cheering-local-restaurant/db/data.dbf' SIZE 100M
	AUTOEXTEND ON NEXT 500K MAXSIZE 15G;

CREATE ROLE DB_LOCAL_ADMIN;

GRANT CONNECT
	, CREATE ANY INDEX			, ALTER ANY INDEX					, DROP ANY INDEX
	, CREATE MATERIALIZED VIEW	, ALTER ANY MATERIALIZED VIEW	, DROP ANY MATERIALIZED VIEW
--	, CREATE ANY PROCEDURE		, ALTER ANY PROCEDURE			, DROP ANY PROCEDURE				, EXECUTE ANY PROCEDURE
	, CREATE ANY SEQUENCE		, ALTER ANY SEQUENCE				, DROP ANY SEQUENCE
	, CREATE ANY TABLE			, ALTER ANY TABLE					, DROP ANY TABLE
--	, CREATE ANY VIEW				, ALTER ANY VIEW					, DROP ANY VIEW
--	, CREATE PROCEDURE
	, CREATE SEQUENCE
	, CREATE TABLE
	, CREATE VIEW
	, INSERT ANY TABLE	, SELECT ANY TABLE	, UPDATE ANY TABLE	, DELETE ANY TABLE			, LOCK ANY TABLE
	, SELECT ANY SEQUENCE
	TO DB_LOCAL_ADMIN
;

CREATE USER RESTAURANT
	IDENTIFIED BY "Password1234"
	DEFAULT TABLESPACE RESTAURANT
	TEMPORARY TABLESPACE TEMP;

GRANT DB_LOCAL_ADMIN TO RESTAURANT;

ALTER USER RESTAURANT QUOTA UNLIMITED ON RESTAURANT;

-- シーケンスの作成
CREATE SEQUENSE RESTOS_SEQ;
CREATE SEQUENSE RESTO_HISTORIES_SEQ;
CREATE SEQUENSE USERS_SEQ;
CREATE SEQUENSE RESTO_LOGIN_REQUESTS_SEQ;
CREATE SEQUENSE RESTO_TEMP_OPEN_DAYS_SEQ;
CREATE SEQUENSE RESTO_TEMP_CLOSE_DAYS_SEQ;
CREATE SEQUENSE RESTO_OPEN_HOURS_SEQ;
CREATE SEQUENSE RESTO_CLOSE_DAYS_WKLY_SEQ;
CREATE SEQUENSE RESTO_CLOSE_DAYS_MO_DOW_SEQ;
CREATE SEQUENSE RESTO_CLOSΕ_DAYS_MO_DOM_SEQ;
CREATE SEQUENSE RESTO_TELNOES_SEQ;
CREATE SEQUENSE RESTO_FAXNOES_SEQ;
CREATE SEQUENSE RESTO_EXTERNAL_LINKS_SEQ;
CREATE SEQUENSE RESTO_PHOTOS_SEQ;
CREATE SEQUENSE RESTO_SEARCH_KEYWORDS_SEQ;
CREATE SEQUENSE MENU_SEQ;
CREATE SEQUENSE MENU_HISTORIES_SEQ;
CREATE SEQUENSE MENU_PHOTOS_SEQ;
CREATE SEQUENSE ORDERS_SEQ;
CREATE SEQUENSE ORDER_DETAILS_SEQ;

-- 郵便番号データ桁数確認用
SELECT
  MAX(NVL(LENGTH(JAPANESE_LOCAL_GOVERMENT_CODE), 0)) AS JAPANESE_LOCAL_GOVERMENT_CODE
  , MAX(NVL(LENGTH(OLD_ZIP_CODE), 0)) AS OLD_ZIP_CODE
  , MAX(NVL(LENGTH(ZIP_CODE), 0)) AS ZIP_CODE
  , MAX(NVL(LENGTH(PREFECTURE_NAME_KANA), 0)) AS PREFECTURE_NAME_KANA
  , MAX(NVL(LENGTH(CITY_NAME_KANA), 0)) AS CITY_NAME_KANA
  , MAX(NVL(LENGTH(TOWN_NAME_KANA), 0)) AS TOWN_NAME_KANA
  , MAX(NVL(LENGTH(PREFECTURE_NAME), 0)) AS PREFECTURE_NAME
  , MAX(NVL(LENGTH(CITY_NAME), 0)) AS CITY_NAME
  , MAX(NVL(LENGTH(TOWN_NAME), 0)) AS TOWN_NAME
  , MAX(NVL(LENGTH(TOWN_DEVIDED_FLAG), 0)) AS TOWN_DEVIDED_FLAG
  , MAX(NVL(LENGTH(ISSUED_PER_KOAZA_FLAG), 0)) AS ISSUED_PER_KOAZA_FLAG
  , MAX(NVL(LENGTH(CHOME_TOWN_FLAG), 0)) AS CHOME_TOWN_FLAG
  , MAX(NVL(LENGTH(HAS_MULTIPLE_TOWN_FLAG), 0)) AS HAS_MULTIPLE_TOWN_FLAG
  , MAX(NVL(LENGTH(UPDATE_DISPLAY_FLAG), 0)) AS UPDATE_DISPLAY_FLAG
  , MAX(NVL(LENGTH(CHANGE_REASON_FLAG), 0)) AS CHANGE_REASON_FLAG 
FROM
  ZIP_CODES;

/*
-- 表領域の一覧を取得する
SELECT * FROM DBA_TABLESPACES;
-- データファイルの一覧を取得する
SELECT * FROM DBA_DATA_FILES;

-- （★リセット用）ユーザーの削除
DROP USER RESTAURANT CASCADE;

-- （★リセット用）表領域の削除
DROP TABLESPACE RESTAURANT
INCLUDING CONTENTS
AND DATAFILES
CASCADE CONSTRAINTS;
*/
```

# メール関連

## メール送信のために必要なパラメーター

起動時の引数として指定する（機微な情報なので、HashiCorp Vaultを使った方法に切り換える想定）

```
spring.mail.host（Yahoo!メールの場合: smtp.mail.yahoo.co.jp、GMailの場合: smtp.gmail.com）
spring.mail.port（Yahoo!メール・GMail両方: 587）
spring.mail.username
spring.mail.password（GMailの場合は2段階認証を有効にしてアプリパスワードを設定しないとブロックされた）
spring.mail.properties.mail.smtp.auth（Yahoo!メール・GMail両方: true）
spring.mail.properties.mail.smtp.starttls.enable（Yahoo!メールの場合: false、GMailの場合: true）

mail.from.address
mail.test.to.address
```